<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tạo Khoa</title>
        <link rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    </head>
    <body>
        <div class="container">
            <h2>Tạo khoa</h2>
            <form>
                <div class="form-group">
                    <label for="nganhName">Nhập tên Khoa:</label>
                    <input type="text" class="form-control" id="nganhName"
                        placeholder="Tên khoa">
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Tên Khoa</th>
                            <th></th> <!-- Cột mới chứa nút sửa -->
                            <th></th> <!-- Cột mới chứa nút xóa -->
                        </tr>
                    </thead>
                    <tbody id="nganhBody">
                        <!-- Dữ liệu của bảng ngành sẽ được thêm sau bằng JavaScript -->
                    </tbody>
                </table>

                <!-- Sửa nút submit và editButton -->
                <button type="button" class="btn btn-primary"
                    id="actionButton">Submit</button>
                <button type="button" class="btn btn-warning" id="editButton"
                    disabled>Cập nhật</button>
                <!-- Thay đổi text và disabled -->
                <input type="hidden" id="editIndex" value>
            </form>
        </div>

        <!-- Các phần HTML khác giữ nguyên -->

        <script>
    // Dữ liệu ngành giả định
var khoaData = [
    {"_id":"32aab472-d77f-7334-9ca9-670e434a273a","name":"Công Nghệ Điện Tử"},
    {"_id":"f2b3b7b4-6246-4d24-9ca9-670e434a273a","name":"Giáo Vụ"},
    {"_id":"82aab472-6246-2352-9b5c-aabbcc2a6cf6","name":"Công Nghệ Thông Tin"}
    // Thêm dữ liệu ngành khác nếu cần
];

// Thêm một hàm xử lý sự kiện cho nút xóa
function addDeleteButtonEvent() {
    var deleteButtons = document.querySelectorAll('.delete-btn');
    deleteButtons.forEach(function(button, index) {
        button.addEventListener('click', function() {
            khoaData.splice(index, 1);
            displaykhoaData();
            document.getElementById('editIndex').value = '';
            document.getElementById('editButton').disabled = true;
            document.getElementById('actionButton').disabled = false; // Kích hoạt nút submit
            document.getElementById('actionButton').innerText = 'Submit'; // Đặt lại text của nút submit
        });
    });
}

// Thay đổi hàm hiển thị dữ liệu để thêm nút xóa và sửa
function displaykhoaData() {
    var nganhBody = document.getElementById('nganhBody');
    nganhBody.innerHTML = '';

    let stt = 0;
    khoaData.forEach(function(nganh, index) {
        stt++;
        var row = "<tr>";
        row += "<td>" + stt + "</td>";
        row += "<td>" + nganh.name + "</td>";
        row += "<td><button type='button' class='btn btn-warning btn-sm edit-btn'>Sửa</button></td>";
        row += "<td><button type='button' class='btn btn-danger btn-sm delete-btn'>Xóa</button></td>"; // Nút xóa mới
        row += "</tr>";
        nganhBody.innerHTML += row;
    });

    addDeleteButtonEvent(); // Thêm sự kiện cho nút xóa mới được thêm vào
    addEditButtonEvent(); // Thêm sự kiện cho nút sửa mới được thêm vào
}

// Bắt sự kiện click cho nút actionButton (thêm và sửa)
document.getElementById('actionButton').addEventListener('click', function() {
    var nganhNameValue = document.getElementById('nganhName').value;
    var buttonValue = this.innerText;

    if (buttonValue === 'Submit') {
        var newNganh = {
            id: generateUUID(),
            name: nganhNameValue
        };

        khoaData.push(newNganh);
    } else if (buttonValue === 'Cập nhật') {
        var index = parseInt(document.getElementById('editIndex').value);

        if (!isNaN(index) && index >= 0 && index < khoaData.length) {
            khoaData[index].name = nganhNameValue;
        }
    }

    displaykhoaData();
    this.innerText = 'Submit';
    document.getElementById('nganhName').value = '';
    document.getElementById('editIndex').value = '';
    document.getElementById('editButton').disabled = true;
});
function addEditButtonEvent() {
    var editButtons = document.querySelectorAll('.edit-btn');
    editButtons.forEach(function(button, index) {
        button.addEventListener('click', function() {
            var row = button.closest('tr');
            var rowIndex = row.rowIndex - 1;
            var nganhNameInput = document.getElementById('nganhName');
            nganhNameInput.value = khoaData[rowIndex].name;
            document.getElementById('editIndex').value = rowIndex;
            document.getElementById('editButton').disabled = false;
            document.getElementById('actionButton').disabled = false;
            document.getElementById('actionButton').innerText = 'Cập nhật';
        });
    });
}

// Bắt sự kiện click cho nút sửa
document.getElementById('editButton').addEventListener('click', function() {
    var nganhNameValue = document.getElementById('nganhName').value;
    var index = parseInt(document.getElementById('editIndex').value);

    if (!isNaN(index) && index >= 0 && index < khoaData.length) {
        khoaData[index].name = nganhNameValue;
        displaykhoaData();
        document.getElementById('editIndex').value = '';
        document.getElementById('editButton').disabled = true;
        document.getElementById('actionButton').disabled = false; // Kích hoạt nút submit
        document.getElementById('actionButton').innerText = 'Submit'; // Đặt lại text của nút submit
    }
});

// Hàm tạo UUID để tạo id mới cho ngành
function generateUUID() {
    var dt = new Date().getTime();
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = (dt + Math.random() * 16) % 16 | 0;
        dt = Math.floor(dt / 16);
        return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
    return uuid;
}

// Gọi hàm để hiển thị dữ liệu ban đầu
displaykhoaData();

    </script>
    </body>
</html>
