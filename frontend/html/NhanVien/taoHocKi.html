<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tạo Học kì</title>
        <link rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <style>
        .selected-row {
            background-color: #f0f0f0; /* Màu nền được chọn */
        }
    </style>
    </head>
    <body>
        <div class="container">
            <h2>Tạo ngành</h2>
            <form>
                <div class="form-group col-md-3">
                    <label for="nganhName">Nhập năm:</label>
                    <input type="number" value="2024" class="form-control"
                        id="year" placeholder="Tên ngành">
                </div>
                <div class="form-group col-md-3">
                    <label for="nganhName">Nhập kì:</label>
                    <input type="number" value="1" class="form-control"
                        id="semester" placeholder="Tên ngành">
                </div>
                <button type="submit" class="btn btn-primary"
                    id="submitButton">Submit</button>
                <button type="button" class="btn btn-success" id="updateButton"
                    disabled>Cập nhật</button>
                <!-- Thay đổi nút Sửa thành Cập nhật -->
                <input type="hidden" id="editIndex" value>
            </form>
            <table class="table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Kì</th>
                        <th>Năm</th>
                        <th>Thao tác</th> <!-- Thêm cột cho nút xóa -->
                    </tr>
                </thead>
                <tbody id="semesterTable">
                    <!-- Dữ liệu của bảng môn học bắt buộc sẽ được thêm sau bằng JavaScript -->
                </tbody>
            </table>
        </div>

        <script>
        // script.js

        var editingIndex = -1; // Biến toàn cục lưu trữ index của học kì đang được sửa

        // Bắt sự kiện khi nhấn vào phần tử trong bảng
        document.getElementById('semesterTable').addEventListener('click', function(event) {
            var target = event.target;
            // Kiểm tra xem phần tử được nhấp vào có phải là một cell trong tbody không
            if (target.tagName.toLowerCase() === 'td') {
                var row = target.parentElement; // Lấy row chứa cell được nhấp vào
                var rowIndex = row.rowIndex; // Lấy index của row
                
                // Lấy dữ liệu từ cell và đổ lên input
                var yearInput = document.getElementById('year');
                var semesterInput = document.getElementById('semester');
                yearInput.value = row.cells[2].innerText; // Cột năm
                semesterInput.value = row.cells[1].innerText; // Cột kì

                // Lưu index của học kì đang được sửa
                editingIndex = rowIndex - 1;

                // Vô hiệu hóa nút submit và kích hoạt nút cập nhật
                document.getElementById('submitButton').disabled = true;
                document.getElementById('updateButton').disabled = false;
            }
        });

        // Thêm sự kiện click cho nút cập nhật
        document.getElementById('updateButton').addEventListener('click', function() {
            // Lấy giá trị từ input "year" và "semester"
            var yearValue = document.getElementById('year').value;
            var semesterValue = document.getElementById('semester').value;
            
            // Kiểm tra xem index của học kì đang được sửa có hợp lệ không
            if (editingIndex >= 0 && editingIndex < semesters.length) {
                // Cập nhật dữ liệu của học kì trong mảng semesters
                semesters[editingIndex].year = parseInt(yearValue);
                semesters[editingIndex].semesterNumber = parseInt(semesterValue);

                // Gọi lại hàm displayHocKi() để cập nhật dữ liệu trên bảng
                displayHocKi();

                // Reset biến editingIndex và form sau khi đã cập nhật dữ liệu
                editingIndex = -1;
                document.getElementById('submitButton').disabled = false;
                document.getElementById('updateButton').disabled = true;
            }
        });

        // Bắt sự kiện submit của form
        document.querySelector('form').addEventListener('submit', function(event) {
            // Ngăn chặn việc gửi form đi, để không load lại trang
            event.preventDefault();

            // Lấy giá trị từ input "year" và "semester"
            var yearValue = document.getElementById('year').value;
            var semesterValue = document.getElementById('semester').value;

            // Tạo một object mới đại diện cho học kì mới
            var newSemester = {
                id: generateUUID(), // Tạo id mới
                year: parseInt(yearValue), // Chuyển giá trị sang số nguyên
                semesterNumber: parseInt(semesterValue) // Chuyển giá trị sang số nguyên
            };

            // Thêm học kì mới vào mảng semesters
            semesters.push(newSemester);

            // Gọi lại hàm displayHocKi() để cập nhật dữ liệu trên bảng
            displayHocKi();

            // Reset form sau khi đã thêm dữ liệu
            this.reset();
        });

        // Hàm tạo UUID để tạo id mới cho học kì
        function generateUUID() {
            var dt = new Date().getTime();
            var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = (dt + Math.random() * 16) % 16 | 0;
                dt = Math.floor(dt / 16);
                return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
            return uuid;
        }

        function addDeleteButtonEvent() {
        var deleteButtons = document.querySelectorAll('.delete-button');
        deleteButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                var row = this.closest('tr');
                var rowIndex = row.rowIndex - 1; // Lấy index của row trong mảng semesters
                semesters.splice(rowIndex, 1); // Xóa học kì khỏi mảng semesters
                displayHocKi(); // Hiển thị lại bảng
            });
        });
    }

        var semesters = [
            { "_id": "dd2e5d9a-74c7-4232-9d56-ee253821241d", "year": 2024, "semesterNumber": 1, "_class": "edu.iuh.administratorservice.entity.Semester" },
            { "_id": "0dde8bd9-ed74-4f19-b70b-29b73a969ec6", "year": 2024, "semesterNumber": 2, "_class": "edu.iuh.administratorservice.entity.Semester" },
            { "_id": "15ab6081-0ff8-425f-aa55-2e206048e4a1", "year": 2024, "semesterNumber": 3, "_class": "edu.iuh.administratorservice.entity.Semester" }
            // Thêm dữ liệu môn học bắt buộc khác nếu cần
        ];

       function displayHocKi() {
            var tbody = document.getElementById('semesterTable');
            tbody.innerHTML = ''; // Xóa hết dữ liệu cũ trong tbody

            let stt = 0;
            semesters.forEach(function (semester) {
                stt++;
                var row = document.createElement("tr");
                row.innerHTML = "<td>" + stt + "</td>" +
                    "<td>" + semester.semesterNumber + "</td>" +
                    "<td>" + semester.year + "</td>" +
                    "<td>" +
                    "<button class='btn btn-danger delete-button'>Xóa</button>" + // Nút xóa
                    "<button class='btn btn-warning edit-button'>Sửa</button>" + // Nút sửa
                    "</td>";
                tbody.appendChild(row);
            });

            addDeleteButtonEvent(); // Thêm sự kiện cho các nút xóa mới được thêm vào
            addEditButtonEvent(); // Thêm sự kiện cho các nút sửa mới được thêm vào
        }

        // Thêm sự kiện click cho các nút sửa mới được thêm vào
        function addEditButtonEvent() {
            var editButtons = document.querySelectorAll('.edit-button');
            editButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    var row = this.closest('tr');
                    var rowIndex = row.rowIndex - 1; // Lấy index của row trong mảng semesters
                    var semester = semesters[rowIndex];
                    // Hiển thị thông tin của học kì trong các trường nhập liệu
                    document.getElementById('year').value = semester.year;
                    document.getElementById('semester').value = semester.semesterNumber;
                    // Lưu index của học kì đang được sửa
                    editingIndex = rowIndex;
                    // Vô hiệu hóa nút submit và kích hoạt nút cập nhật
                    document.getElementById('submitButton').disabled = true;
                    document.getElementById('updateButton').disabled = false;
                });
            });
        }

        // Gọi hàm để hiển thị dữ liệu ban đầu
        displayHocKi();
    </script>
    </body>
</html>
